---
title: TCP/IP 5 Layer
date: 2022-11-14 10:13:19
category: 카테고리
tag: [Networking, CS]
series: Computer Networking a Top-Down Apporach
excerpt: "What is TCP/IP 5 Layer and introduction of Computer Networking a Top-Down Approach"
cover_image: /images/posts/networking.jpg
draft: true
---

## 왜 네트워크를 배워야 하는가?

처음 프로그래밍을 배울 때 인터넷에서 강의 영상을 많이 따라 했었다.
튜토리얼을 따라 그대로 입력하면 통신이 되었지만, 왜 통신이 되는지 이해할 수 없었다.
그래서 다른 선택지가 어떤 것이 있으며, 각각의 장단점은 무엇이고, 왜 이방법을 선택했는지 설명할 수가 없었다.
나는 이 시점에서 전공 공부를 시작해야 한다고 느꼈다.
다른 사람이 만든 것을 그대로 따라하면 어떻게든 만들 수는 있을 것이다.
그렇지만 대부분은 코드 뒤에 숨겨진 네트워크의 동작 방법은 설명하지 않는다.
원리를 모른채로 사용하면 어떤 점이 문제인지 알 수 없고, 현재 만드는 방법의 옳고 그름을 판단할 수 없다.
프레임워크의 힘을 빌리더라도 기본적인 작동 방법은 이해해야만 제대로 코드를 만들 수 있는 것이다.

이 시리즈는 *Computer Networking a Top-Down Approach*라는 책을 기반으로 정리한 것이다.
처음에는 책의 내용을 그대로 정리하는 것에 그치려고 했으나, 생각보다 부족한 점이 많아서 새로 정리하기로 마음 먹었다.
지금까지 느낀 전공 서적의 가장 큰 문제점은 그 구성이 학습하는데 적절하지 않다는 것이다.
책은 같은 주제를 한 곳에 모아야 하고, 같은 내용을 여러 번 설명하지 않으며, 정직한 방법으로 설명해야 한다.
처음 배우는 사람 뿐만 아니라 복습하는 사람이 원하는 내용을 다시 찾기 쉽도록 만들기 위함일 것이다.
그렇지만 이 때문에 배우기 어려워지기도 한다.
예를 들어 앞의 챕터를 이해하는데 뒷 챕터가 필요하다거나, 연관 지어서 설명하기 좋은 내용을 챕터별로 나누다보니 멀리 떨어지기도 한다.
또한 지나치게 자세할때도 있고, 상대적으로 덜 중요한 내용에 많은 페이지를 할애하기도 한다.
그래서 현실의 강의는 책의 구성을 따라가되 적절히 생략하고 그 순서를 바꾸는 경우가 많은 것이다.
나 역시 책을 그대로 따라가는 것을 비효율적이라 느낀바 새롭게 정리하기로 했다.
내가 중점적으로 생각한 것은 질문의 흐름에 따라 정리하는 것이다.
어떤 내용을 배우면 의문점이 생기고 이를 알아보려 자료를 찾아보는 것이 학습의 흐름이다.
나는 이 물살을 거스르기 보단 그대로 따라가며 설명하려고 한다.
이 과정에서 많은 내용이 중복되리라 생각되지만, 많이 중복되는 내용은 그만큼 중요하다는 의미일 테니 아무리 많이 말해도 부족함이 없을 것이다.
의식의 흐름을 따라가며 적다보니 부족한 점이 많겠지만 여러 번 수정하면서 어떻게든 고쳐나가겠다.

## TCP/IP 5 Layer

네트워크의 가장 핵심적인 아이디어는 네트워크를 계층으로 나눈 것이다.
여기서 계층이 무엇이며 왜 필요한지 알기 위해선 데이터가 네트워크 경로를 따라 상대 컴퓨터에 어떻게 도착하는지 알아야 한다.
하지만 우리는 아직 네트워크의 출발점에 있기에 위 과정이 불가능하다.
계층을 나중에 설명하자니 너무나 핵심적인 아이디어라 뒤로 미룰 수도 없다.
그래서 네트워크와 비슷한 구조를 가진 현실의 모델을 가지고 설명해보겠다.
나는 그 중에서도 택배 배송을 예시로 들어서 설명하겠다.

A가 B에게 택배를 보내려고 한다.
A는 우체국1에 택배를 맡기고, 우체국은 이를 택배 기사에게 넘겨준다.
그리고 우체국2에 도착한 택배를 B에게 전달한다.

```
+--------------+
|      A       |
|      ↓       |
| Post Office1 |
|      ↓       |
|   Courier    |
|      ↓       |
| Post Office2 |
|      ↓       |
|      B       |
+--------------+
```

여기서 재밌는 점이 있는데 A는 택배 배송을 우체국1에게 맡기고 아무 일도 하지 않는다는 것이다.
A는 택배가 B에게 전달되는 것만 명시할 뿐, 그 사이어 어떤 우체국을 거쳐야 하며 어떤 택배기사가 배송해야할지 정하지 않는다.
이들은 우체국1에서 알아서 정해줄 뿐이다.
A 입장에서는 사이 단계를 알지 못하며 단지 B가 받게 된다는 사실만 안다.
그 결과 A와 B는 사이에 어떤 구조가 있는지 모른채로 소통한다.

```
+--------------+
|      A       |
|      ↓       |
|     ???      |
|      ↓       |
|      B       |
+--------------+
```

우체국 입장에서도 비슷한 결과가 나온다.
우체국1은 우체국2로 배송하기만 하면 된다.
그 사이에서 어떤 기사가 배달해야 하며, 또 어떤 경로로 배달할지는 신경쓰지 않는다.
그래서 어디로 가야할지 목적지만 정해줄 뿐이며, 그 사이의 일은 택배원에게 전적으로 맡긴다.
뿐만 아니라 A와 B에 관한 정보도 알 필요가 없는 것이, 필요한 정보는 모두 송장에 적혀있다.

```
+--------------+
| Post Office1 |
|      ↓       |
|     ???      |
|      ↓       |
| Post Office2 |
+--------------+
```

마지막으로 택배 기사 역시 우체국1에서 우체국2로 전달한다는 내용만 알고 있으면 된다.
그 외에 A나 B에게 명령 받는 내용도 없고, 경로 역시 본인이 가장 빠르다고 생각되는 경로로 전달하기만 하면 된다.

택배 배송의 예에서 알 수 있듯이 상대방에 대한 정보 외에는 그다지 필요가 없다.
또한 일을 위임시킬 뿐 그 사이에 어떻게 동작할지 직접적으로 지정하는 것도 불가능하다.
지금까지의 구조로 보아 택배 배송은 아래처럼 표시하는 것이 더 적절하다.

```
+--------------+--------------+
|      A              B       |
+--------------+--------------+
|      ↓              ↑       |
| Post Office1   Post Office2 |
|      ↘              ↗       |
+--------------+--------------+
|            Courier          |
+--------------+--------------+
```

위에서 보듯이 서로 소통할 수 있는 대상 끼리는 같은 층에 두었다.
그리고 각 층은 아래 층에 해야할 일을 위임하며, 목적지는 지정할 수 있지만 자세한 명령을 할 수 없다.
네트워크에서도 위와 같은 구조를 사용하는데 각 층을 계층이라고 부른다.
각 계층은 아래 계층에 네트워크 전송을 위임하므로 사이에 어떤 전송 과정을 거치는지 알 수 없다.

컴퓨터 역시 이런 식으로 계층으로 나뉘어 있다.
통신 시에 사이 과정을 알 수 없으므로 같은 계층 끼리만 소통한다고 생각할 수 있고, 통신에 필요한 일을 하위 계층에 위임하는 방식으로 동작한다.
컴퓨터는 5계층을 사용하는 TCP/IP 5 Layer과 7계층을 사용하는 OSI 7 Layer이 있다.
그 중에서도 우리는 TCP/IP를 사용하고 그 구조는 아래와 같다.

```
+-------------+
| Application |
+-------------+
| Transport   |
+-------------+
| Network     |
+-------------+
| Data Link   |
+-------------+
| Physical    |
+-------------+
```

## TCP/IP의 특징

TCP/IP는 같은 계층 안의 상대와 대화하도록 만들어졌다.
그러므로 같은 계층의 상대와 어떤 방법으로 소통하며 데이터를 어떻게 해석할지 미리 정해야 한다.
이처럼 통신 방법을 정한 규약을 프로토콜이라고 하며, 같은 계층은 동일한 프로토콜을 사용한다.
그러므로 TCP/IP는 프로토콜 단위로 계층을 나누었다고도 할 수 있다.

TCP/IP는 통신을 아래로 위임하는 방식으로 동작한다고 했다.
그런데 각 계층은 다른 프로토콜을 사용하므로 각 프로토콜에 필요한 추가 정보가 들어가게 된다.
또한 다시 상위 계층으로 돌려줄 때 원본 데이터를 복원할 수 있어야 한다.
TCP/IP는 간단한 방법으로 이를 해결했는데, 원본 데이터에 헤더라는 데이터를 추가로 붙여주는 것이다.
헤더에는 프로토콜에 필요한 모든 데이터가 들어 있고, 나중에 복원할 때는 헤더만 없애주면 된다.
현실의 모델을 참고하자면 박스와 비슷하다고 할 수 있다.
택배 상품을 전달하기 위해선 목적지 정보, 상품이 깨지는지 여부, 특급 배송 여부 등의 정보를 알아야 한다.
이 정보를 송장에 적은 다음 상품을 택배 상자에 담아서 보낸다.
그 후 고객은 상자를 열어 상품을 받게 된다.
이처럼 안의 내용물을 감싸서 전달하기 때문에, 위의 헤더를 붙이는 과정을 캡슐화(Encapsulation)이라고 한다.
그리고 헤더를 제거하는 과정을 De-Encapsulation이라고 한다.

각 계층은 서로 다른 프로토콜을 사용하고, 각자 다른 헤더 구조를 사용한다.
그렇기 때문에 데이터 모양이 다르고 이를 부르는 명칭도 다르다.
예를 들어서 어플리케이션 계층에서는 데이터를 메세지라고 부르고, 트랜스포트 계층은 세그먼트/데이터 그램이라고 한다.
앞으로 각 장에서 데이터를 다른 이름으로 부르게 될텐데, 각자 다른 프로토콜을 사용해서 구분할 뿐 데이터를 전달하는 본질이 달라진 것은 아니다.

마지막으로 각 계층은 서로를 구분하는 방법이 다르다.
네트워크는 IP 주소로 서로를 구분하고, 트랜스포트 계층은 포트로 구분하고, 데이터 링크 계층은 맥 어드레스로 구분한다.

```

+-------+-------------+--------------------+--------------------+-------------+
| Layer |    Name     |      Protocol      |     Data Unit      | Addressing  |
+-------+-------------+--------------------+--------------------+-------------+
|     5 | Application | HTTP, SMTP, etc... | Messages           | x           |
|     4 | Transport   | TCP/UDP            | Segments/Datagrams | Port        |
|     3 | Network     | IP                 | Packets            | IP Address  |
|     2 | Data Link   | Ethernet, Wi-Fi    | Frames             | MAC Address |
|     1 | Physical    | 10 Base T, 802.11  | Bits               | x           |
+-------+-------------+--------------------+--------------------+-------------+
```

## TCP/UDP

앞으로 상위 계층에서 하위 계층으로 내려가며 네트워크를 공부할 것이다.
문제는 애플리케이션을 설명할 때 바로 아래인 Transpot 계층을 어느 정도 이해할 필요가 있다는 점이다.
그래서 TCP/UDP 통신을 미리 설명하고자 한다.
